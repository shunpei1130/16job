<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>å°±æ´»ã‚­ãƒ£ãƒ©è¨ºæ–­</title>
  <style>
    :root {
      /* Apple-esque Palette */
      --bg: #fbfbfd; /* èƒŒæ™¯ï¼šã»ã‚“ã®ã‚Šã‚°ãƒ¬ãƒ¼ãŒã‹ã£ãŸç™½ */
      --surface: #ffffff; /* ã‚«ãƒ¼ãƒ‰èƒŒæ™¯ï¼šç´”ç™½ */
      --text-main: #1d1d1f; /* ãƒ¡ã‚¤ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼šã»ã¼é»’ */
      --text-sub: #86868b; /* ã‚µãƒ–ãƒ†ã‚­ã‚¹ãƒˆï¼šã‚°ãƒ¬ãƒ¼ */
      --accent: #0071e3; /* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆï¼šApple Blue */
      --accent-soft: #e8f2ff; /* è–„ã„é’ */
      --line: #d2d2d7; /* å¢ƒç•Œç·š */
      --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
      --shadow-lg: 0 12px 30px rgba(0,0,0,0.08);
      --radius: 20px;
      --radius-sm: 12px;
      --danger: #ff3b30;
    }

    * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
    
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg);
      color: var(--text-main);
      line-height: 1.6;
    }

    a { color: var(--accent); text-decoration: none; }

    .wrap {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px 80px;
    }

    /* Header */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 40px;
    }
    .brand { display: flex; align-items: center; gap: 12px; }
    .logo {
      width: 40px; height: 40px; border-radius: 10px;
      background: linear-gradient(135deg, #0071e3, #42a5f5);
      box-shadow: 0 4px 10px rgba(0,113,227,0.3);
    }
    .title h1 { font-size: 18px; margin: 0; font-weight: 600; }
    .title p { margin: 0; color: var(--text-sub); font-size: 12px; }

    /* Buttons */
    button {
      border: 1px solid transparent;
      background: rgba(0,0,0,0.05);
      color: var(--text-main);
      padding: 10px 18px;
      border-radius: 999px; /* Pill shape */
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s ease;
    }
    button:hover { background: rgba(0,0,0,0.08); transform: translateY(-1px); }
    button:active { transform: scale(0.98); }
    
    button.primary {
      background: var(--accent);
      color: white;
      box-shadow: 0 4px 12px rgba(0,113,227,0.25);
    }
    button.primary:hover { background: #0077ed; box-shadow: 0 6px 16px rgba(0,113,227,0.35); }
    
    button.danger { color: var(--danger); background: rgba(255,59,48,0.05); }
    button.danger:hover { background: rgba(255,59,48,0.1); }
    button:disabled { opacity: 0.4; cursor: not-allowed; transform: none; box-shadow: none; }

    /* Panels & Cards */
    .panel {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      padding: 32px;
      margin-bottom: 24px;
      border: 1px solid rgba(255,255,255,0.8);
    }
    @media (max-width: 600px) {
      .panel { padding: 24px 16px; }
    }

    .kicker {
      color: var(--accent);
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin: 0 0 8px;
    }
    .big {
      font-size: 24px;
      font-weight: 700;
      margin: 0 0 16px;
      letter-spacing: -0.01em;
      color: var(--text-main);
    }
    .text-body { font-size: 15px; color: var(--text-sub); }

    /* Progress Bar */
    .progress-wrap { margin: 20px 0; }
    .progress-track {
      height: 6px;
      background: #f0f0f5;
      border-radius: 999px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: var(--accent);
      width: 0%;
      transition: width 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
    }
    .progress-meta {
      display: flex; justify-content: space-between;
      font-size: 11px; color: var(--text-sub); margin-bottom: 6px; font-weight: 500;
    }

    /* Questions (4 Options) */
    .qCard {
      margin-bottom: 40px;
      padding-bottom: 24px;
      border-bottom: 1px solid #f0f0f5;
    }
    .qCard:last-child { border-bottom: none; margin-bottom: 10px; }
    .qText { font-size: 16px; font-weight: 600; margin: 0 0 16px; }
    
    .options-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr); /* 7æŠã«å¤‰æ›´ */
      gap: 10px;
    }
    @media (max-width: 500px) {
      .options-grid { grid-template-columns: 1fr 1fr; gap: 8px; } /* ã‚¹ãƒãƒ›ã¯2åˆ—x2è¡Œ */
    }

    .opt-btn {
      position: relative;
    }
    .opt-btn input { display: none; }
    .opt-btn label {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 14px 4px;
      background: #f5f5f7;
      border: 2px solid transparent;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      height: 100%;
      min-height: 64px;
      text-align: center;
    }
    .opt-btn label .t { font-size: 12px; font-weight: 600; color: var(--text-sub); line-height: 1.2; }
    
    /* Checked State */
    .opt-btn input:checked + label {
      background: var(--accent-soft);
      border-color: var(--accent);
      color: var(--accent);
    }
    .opt-btn input:checked + label .t { color: var(--accent); }

    /* Results */
    .result-hero {
      text-align: center;
      margin-bottom: 40px;
    }
    .char-image-placeholder {
      width: 100%;
      max-width: 320px;
      aspect-ratio: 1 / 1;
      background: #f0f0f5;
      border-radius: 24px;
      margin: 20px auto;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-sub);
      font-size: 13px;
      border: 1px dashed #d2d2d7;
      overflow: hidden; /* ç”»åƒãŒå…¥ã£ãŸæ™‚ã«ã¯ã¿å‡ºã•ãªã„ã‚ˆã†ã« */
    }
    .char-image-placeholder img {
        width: 100%; height: 100%; object-fit: cover; display: none; /* ç”»åƒæŒ‡å®šæ™‚ã¯blockã« */
    }

    .card-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 24px;
    }
    @media (max-width: 700px) { .card-grid { grid-template-columns: 1fr; } }

    .info-card {
      background: #f5f5f7;
      padding: 20px;
      border-radius: 16px;
    }
    .info-card h3 { margin: 0 0 12px; font-size: 15px; color: var(--text-main); }
    .info-card ul { margin: 0; padding-left: 20px; font-size: 13px; color: var(--text-main); }
    .info-card li { margin-bottom: 6px; }

    /* Axis Bars */
    /* Axis Indicator */
    .axis-row { margin-bottom: 18px; }
    .axis-name { font-size: 13px; font-weight: 600; margin-bottom: 6px; display: block; }
    .axis-labels { display: flex; justify-content: space-between; font-size: 11px; color: var(--text-sub); margin-bottom: 6px; }
    .axis-meta { display:flex; justify-content: space-between; gap: 10px; font-size: 11px; color: var(--text-sub); margin-top: 6px; }
    .axis-track {
      height: 10px;
      background: #e5e5ea;
      border-radius: 999px;
      position: relative;
      overflow: visible;
    }
    .axis-center {
      position:absolute;
      left:50%;
      top:50%;
      width: 2px;
      height: 14px;
      background: rgba(0,0,0,0.10);
      transform: translate(-50%, -50%);
      border-radius: 2px;
    }
    .axis-dot {
      position:absolute;
      top:50%;
      width: 14px;
      height: 14px;
      background: var(--accent);
      border: 3px solid #fff;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 8px 16px rgba(0,0,0,0.12);
    }
    details.axis-details { margin-top: 8px; }
    details.axis-details summary { cursor:pointer; color: var(--accent); font-size: 12px; font-weight: 600; }
    .axis-breakdown {
      margin-top: 10px;
      background: #f5f5f7;
      border-radius: 14px;
      padding: 12px;
      font-size: 12px;
      color: var(--text-main);
    }
    .axis-breakdown .row {
      display:flex;
      gap: 10px;
      align-items:flex-start;
      padding: 8px 0;
      border-bottom: 1px solid rgba(0,0,0,0.06);
    }
    .axis-breakdown .row:last-child { border-bottom: none; }
    .axis-breakdown .q { flex: 1; color: var(--text-main); }
    .axis-breakdown .a { width: 108px; text-align:right; color: var(--text-sub); white-space: nowrap; }
    .axis-breakdown .dir { width: 44px; text-align:right; font-weight: 700; }


    /* Utility */
    .hidden { display: none; }
    .fade-in { animation: fadeIn 0.4s ease forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    footer {
      text-align: center;
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 40px;
    }
  
    /* 7æŠã‚µãƒ¼ã‚¯ãƒ«UI */
    .likert7{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:14px;
      padding: 10px 0 6px;
      flex-wrap: nowrap;
    }
    .likert-end{
      font-size: 13px;
      font-weight: 700;
      min-width: 84px;
      white-space: nowrap;
      flex-shrink: 1;
    }
    .likert-end.left{ color:#2f9e73; }
    .likert-end.right{ color:#7b5aa6; }

    .likert-btn{
      appearance:none;
      -webkit-appearance:none;
      border: 3px solid rgba(0,0,0,0.25);
      background: transparent;
      border-radius: 999px;
      cursor: pointer;
      padding: 0;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      transition: transform 80ms ease, border-color 180ms ease, box-shadow 180ms ease;
      flex-shrink: 0;
    }
    .likert-btn[data-i="1"], .likert-btn[data-i="7"] { width: 76px; height: 76px; }
    .likert-btn[data-i="2"], .likert-btn[data-i="6"] { width: 58px; height: 58px; }
    .likert-btn[data-i="3"], .likert-btn[data-i="5"] { width: 44px; height: 44px; }
    .likert-btn[data-i="4"] { width: 30px; height: 30px; }

    .likert-btn.left  { border-color: rgba(47,158,115,0.85); }
    .likert-btn.mid   { border-color: rgba(140,140,148,0.65); }
    .likert-btn.right { border-color: rgba(123,90,166,0.85); }

    .likert-btn.selected{
      box-shadow: 0 0 0 6px rgba(0,113,227,0.12);
      border-color: rgba(0,113,227,0.65);
    }
    .likert-btn:active{ transform: scale(0.98); }

    @media (max-width: 420px){
      .likert7{ gap: 4px; flex-wrap: nowrap; }
      .likert-end{ min-width: auto; font-size: 10px; flex-shrink: 1; }
      .likert-btn[data-i="1"], .likert-btn[data-i="7"] { width: 50px; height: 50px; }
      .likert-btn[data-i="2"], .likert-btn[data-i="6"] { width: 42px; height: 42px; }
      .likert-btn[data-i="3"], .likert-btn[data-i="5"] { width: 34px; height: 34px; }
      .likert-btn[data-i="4"] { width: 26px; height: 26px; }
    }
    @media (max-width: 360px){
      .likert7{ gap: 2px; }
      .likert-end{ font-size: 9px; }
      .likert-btn[data-i="1"], .likert-btn[data-i="7"] { width: 44px; height: 44px; }
      .likert-btn[data-i="2"], .likert-btn[data-i="6"] { width: 38px; height: 38px; }
      .likert-btn[data-i="3"], .likert-btn[data-i="5"] { width: 30px; height: 30px; }
      .likert-btn[data-i="4"] { width: 24px; height: 24px; }
    }

  </style>
</head>
<body>

  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo"></div>
        <div class="title">
          <h1>å°±æ´»ã‚­ãƒ£ãƒ©è¨ºæ–­</h1>
          <p>ã‚ãªãŸã®å‹ã¡ç­‹ã¨é©è·ã‚¿ã‚¤ãƒ—</p>
        </div>
      </div>
      <div>
        <button class="danger" id="btnReset" style="font-size:11px;">ãƒªã‚»ãƒƒãƒˆ</button>
      </div>
    </header>

    <main id="app"></main>

    <footer>
      <p>â€»æœ¬è¨ºæ–­ã¯ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã§ã™ã€‚çµæœã¯ç«¯æœ«ã«ã®ã¿ä¿å­˜ã•ã‚Œã¾ã™ã€‚</p>
    </footer>
  </div>

  <script>
    /***********************
     * Data & Logic
     ***********************/
    const AXES = {
      A: { key:"A", name:"æƒ…å ±ã®é›†ã‚æ–¹", left:"èª­ã‚€ï¼ˆä¸€æ¬¡æƒ…å ±ï¼‰", right:"è©±ã™ï¼ˆå¯¾è©±ï¼‰" },
      B: { key:"B", name:"å¾—æ„ãªç’°å¢ƒ", left:"å®‰å®šãƒ»ä»•çµ„ã¿", right:"å¤‰åŒ–ãƒ»ã‚«ã‚ªã‚¹" },
      C: { key:"C", name:"å‹•æ©Ÿã®æºæ³‰", left:"æ„ç¾©ãƒ»äºº", right:"åˆç†ãƒ»æˆæœ" },
      D: { key:"D", name:"é€²ã‚æ–¹", left:"è¨ˆç”»çš„", right:"æŸ”è»Ÿãƒ»å³èˆˆ" }
    };

    const ANS_LABEL = {1:"å…¨ãé•ã†", 2:"ã‚„ã‚„é•ã†", 3:"ã‚„ã‚„ãã†æ€ã†", 4:"å¼·ããã†æ€ã†"};


    // 7æŠç”¨ã«ã‚¹ã‚³ã‚¢èª¿æ•´: 1(Strongly Disagree) .. 4(Strongly Agree)
    // Reverseãªã‚‰: 5 - answer
    const QUESTIONS = [
      // A: èª­ã‚€ï¼ˆä¸€æ¬¡æƒ…å ±ï¼‰ vs è©±ã™ï¼ˆå¯¾è©±ï¼‰
      {id:"A1", axis:"A", text:"ä¼æ¥­ç ”ç©¶ã¯ã¾ãšå…¬å¼æƒ…å ±ï¼ˆæ¡ç”¨ã‚µã‚¤ãƒˆãƒ»IRãªã©ï¼‰ã‚’èª­ã¿è¾¼ã‚€", reverse:false},
      {id:"A2", axis:"A", text:"äººã«ä¼šã†å‰ã«ã€è‡ªåˆ†ã§èª¿ã¹å°½ãã—ã¦ã‹ã‚‰è‡¨ã¿ãŸã„", reverse:false},
      {id:"A3", axis:"A", text:"æ–‡ç« ã‚„è³‡æ–™ã‚’èª­ã‚€ã»ã†ãŒç†è§£ãŒæ·±ã¾ã‚‹", reverse:false},
      {id:"A4", axis:"A", text:"ç–‘å•ã¯ã¾ãšæ¤œç´¢ãƒ»è³‡æ–™ã§ç¢ºèªã—ã¦ã‹ã‚‰è³ªå•ã™ã‚‹", reverse:false},
      {id:"A5", axis:"A", text:"è€ƒãˆã¯ãƒ¡ãƒ¢ã‚„æ–‡ç« åŒ–ã§æ•´ç†ã™ã‚‹ã“ã¨ãŒå¤šã„", reverse:false},
      {id:"A6", axis:"A", text:"äººã«è©±ã—ã¦ã¿ã‚‹ã¨è€ƒãˆãŒã¾ã¨ã¾ã£ã¦ãã‚‹", reverse:true},
      {id:"A7", axis:"A", text:"è³‡æ–™ã‚ˆã‚Šã€åƒãäººã®â€œç”Ÿã®å£°â€ã®ã»ã†ãŒåˆ¤æ–­ææ–™ã«ãªã‚‹", reverse:true},
      {id:"A8", axis:"A", text:"ã¾ãšäººã«ä¼šã£ã¦èããªãŒã‚‰ã€æƒ…å ±ã‚’åŸ‹ã‚ã¦ã„ãã‚¿ã‚¤ãƒ—ã ", reverse:true},
      {id:"A9", axis:"A", text:"è‡ªåˆ†ã§èª¿ã¹ã‚‹ã‚ˆã‚Šã€è©³ã—ã„äººã«èãã»ã†ãŒæ—©ã„ã¨æ€ã†", reverse:true},
      {id:"A10", axis:"A", text:"ä¼šè©±ã®ä¸­ã§ãã®å ´ã§è³ªå•ãŒã©ã‚“ã©ã‚“æ¹§ã„ã¦ãã‚‹", reverse:true},

      // B: å®‰å®šãƒ»ä»•çµ„ã¿ vs å¤‰åŒ–ãƒ»ã‚«ã‚ªã‚¹
      {id:"B1", axis:"B", text:"å½¹å‰²ã¨è©•ä¾¡åŸºæº–ãŒæ˜ç¢ºãªã»ã†ãŒåŠ›ã‚’å‡ºã›ã‚‹", reverse:false},
      {id:"B2", axis:"B", text:"æ‰‹é †ã‚„ãƒ«ãƒ¼ãƒ«ãŒæ•´ã£ã¦ã„ã‚‹ã¨å®‰å¿ƒã™ã‚‹", reverse:false},
      {id:"B3", axis:"B", text:"ç ”ä¿®ã‚„è‚²æˆã®ä»•çµ„ã¿ãŒã‚ã‚‹ç’°å¢ƒãŒå¥½ãã ", reverse:false},
      {id:"B4", axis:"B", text:"å‰ä¾‹ã‚„å‹ãŒã‚ã‚‹ã»ã†ãŒæ”¹å–„ã—ã‚„ã™ã„", reverse:false},
      {id:"B5", axis:"B", text:"å¤‰åŒ–ãŒå°‘ãªã„ç’°å¢ƒã®ã»ã†ãŒé›†ä¸­ã§ãã‚‹", reverse:false},
      {id:"B6", axis:"B", text:"å‰ä¾‹ã®ãªã„ãƒ†ãƒ¼ãƒã»ã©ãƒ¯ã‚¯ãƒ¯ã‚¯ã™ã‚‹", reverse:true},
      {id:"B7", axis:"B", text:"ãƒ«ãƒ¼ãƒ«ãŒãªãã¦ã‚‚è‡ªåˆ†ã§å‹ã‚’ä½œã£ã¦é€²ã‚ã‚‰ã‚Œã‚‹", reverse:true},
      {id:"B8", axis:"B", text:"æ–¹é‡ãŒé »ç¹ã«å¤‰ã‚ã‚‹ç’°å¢ƒã§ã‚‚ã‚€ã—ã‚ç‡ƒãˆã‚‹", reverse:true},
      {id:"B9", axis:"B", text:"0â†’1ã§ç«‹ã¡ä¸Šã’ã‚‹ä»•äº‹ã‚’ã‚„ã‚ŠãŸã„", reverse:true},
      {id:"B10", axis:"B", text:"æ•´ã£ã¦ã„ãªã„ç’°å¢ƒã‚’è‡ªåˆ†ã§æ•´ãˆã‚‹ã®ãŒå¥½ãã ", reverse:true},

      // C: æ„ç¾©ãƒ»äºº vs åˆç†ãƒ»æˆæœ
      {id:"C1", axis:"C", text:"ã€Œèª°ã®èª²é¡Œã‚’è§£ãã‹ã€ãŒæ˜ç¢ºã ã¨ã‚„ã‚‹æ°—ãŒå‡ºã‚‹", reverse:false},
      {id:"C2", axis:"C", text:"ç†å¿µã‚„ãƒŸãƒƒã‚·ãƒ§ãƒ³ã¸ã®å…±æ„Ÿã‚’é‡è¦–ã™ã‚‹", reverse:false},
      {id:"C3", axis:"C", text:"æ„Ÿè¬ã•ã‚ŒãŸã‚Šå½¹ã«ç«‹ã¦ã‚‹ã¨é ‘å¼µã‚Œã‚‹", reverse:false},
      {id:"C4", axis:"C", text:"ç›¸æ‰‹ã®æ°—æŒã¡ã‚„ç´å¾—æ„Ÿã‚’å¤§äº‹ã«ã—ã¦åˆ¤æ–­ã—ãŸã„", reverse:false},
      {id:"C5", axis:"C", text:"è‡ªåˆ†ã®ä¾¡å€¤è¦³ã«åã™ã‚‹ä»•äº‹ã¯é¿ã‘ãŸã„", reverse:false},
      {id:"C6", axis:"C", text:"æˆæœï¼ˆæ•°å­—ãƒ»KPIï¼‰ãŒå‡ºãªã„ãªã‚‰æ„å‘³ãŒè–„ã„ã¨æ„Ÿã˜ã‚‹", reverse:true},
      {id:"C7", axis:"C", text:"æ¡ä»¶ï¼ˆçµ¦ä¸ãƒ»æˆé•·æ©Ÿä¼šï¼‰ã‚’åˆç†çš„ã«æ¯”è¼ƒã—ã¦é¸ã³ãŸã„", reverse:true},
      {id:"C8", axis:"C", text:"ãƒ‡ãƒ¼ã‚¿ã‚„ãƒ­ã‚¸ãƒƒã‚¯ã‚’å„ªå…ˆã—ã¦æ„æ€æ±ºå®šã—ãŸã„", reverse:true},
      {id:"C9", axis:"C", text:"å‹ã¦ã‚‹ç¢ºåº¦ãŒé«˜ã„é¸æŠã‚’å–ã‚ŠãŸã„", reverse:true},
      {id:"C10", axis:"C", text:"â€œå¥½ãå«Œã„â€ã‚ˆã‚Šãƒªã‚¿ãƒ¼ãƒ³ã§æ±ºã‚ã‚‹ã“ã¨ãŒå¤šã„", reverse:true},

      // D: è¨ˆç”»çš„ vs æŸ”è»Ÿãƒ»å³èˆˆ
      {id:"D1", axis:"D", text:"ç· åˆ‡ã‚ˆã‚Šã‹ãªã‚Šå‰ã‹ã‚‰æº–å‚™ã™ã‚‹", reverse:false},
      {id:"D2", axis:"D", text:"ToDoã‚„æ®µå–ã‚Šã‚’ä½œã‚‹ã¨å®‰å¿ƒã™ã‚‹", reverse:false},
      {id:"D3", axis:"D", text:"é¢æ¥ã®æƒ³å®šå•ç­”ã¯äº‹å‰ã«ç”¨æ„ã—ã¦ãŠã", reverse:false},
      {id:"D4", axis:"D", text:"ãƒªã‚¹ã‚¯ã‚’æ´—ã„å‡ºã—ã¦å¯¾ç­–ã—ã¦ã‹ã‚‰å‹•ã", reverse:false},
      {id:"D5", axis:"D", text:"è¨ˆç”»ãŒç«‹ã¤ã¨è¿·ã„ãŒæ¸›ã‚‹", reverse:false},
      {id:"D6", axis:"D", text:"ç´°ã‹ã„è¨ˆç”»ã‚ˆã‚Šã€ã¾ãšå‹•ã„ã¦é€”ä¸­ã§èª¿æ•´ã™ã‚‹", reverse:true},
      {id:"D7", axis:"D", text:"çŠ¶æ³ã‚’è¦‹ã¦å„ªå…ˆé †ä½ã‚’å…¥ã‚Œæ›¿ãˆã‚‹ã®ãŒå¾—æ„ã ", reverse:true},
      {id:"D8", axis:"D", text:"æº–å‚™ãŒä¸ååˆ†ã§ã‚‚å‹¢ã„ã§åˆ‡ã‚ŠæŠœã‘ã‚‰ã‚Œã‚‹", reverse:true},
      {id:"D9", axis:"D", text:"äºˆå®šãŒå´©ã‚Œã¦ã‚‚ã™ãåˆ¥æ¡ˆã‚’å‡ºã›ã‚‹", reverse:true},
      {id:"D10", axis:"D", text:"ç›´å‰ã®è¿½ã„è¾¼ã¿ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒä¸ŠãŒã‚‹", reverse:true},
    ];

    const CHARACTERS = {
      "LLLL": {name:"é™ã‹ãªã‚‹å‚è¬€", summary:"å¾¹åº•çš„ãªèª¿æŸ»ã¨è¨ˆç”»ã§ã€çµ„ç¹”ã‚’è£ã‹ã‚‰æ”¯ãˆã‚‹çŸ¥æ€§æ´¾ã€‚"},
      "LLLR": {name:"èª¿æ•´ã®ã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆ", summary:"æƒ…å ±ã‚’æ•´ç†ã—ã€ç›¸æ‰‹ã«åˆã‚ã›ã¦æŸ”è»Ÿã«ä¼ãˆã‚‹æ¶ã‘æ©‹ã€‚"},
      "LLRL": {name:"å …å®Ÿãªå®Ÿå‹™å®¶", summary:"è¦ä»¶ã‚’æ•´ç†ã—ã€ç€å®Ÿã«å®Ÿè¡Œã—ã¦æˆæœã‚’ç©ã¿ä¸Šã’ã‚‹ã€‚"},
      "LLRR": {name:"ç¾å ´ã®æ”¹å–„è·äºº", summary:"ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚’å®ˆã‚Šã¤ã¤ã€ç¾å ´ã®è©°ã¾ã‚Šã‚’æŸ”è»Ÿã«ç›´ã™ã€‚"},
      "LRLL": {name:"æœªæ¥ã‚’æãå»ºç¯‰å®¶", summary:"å¤‰åŒ–ã‚’èª­ã¿è§£ãã€æ–°ã—ã„ä»•çµ„ã¿ã‚’ç€å®Ÿã«ä½œã‚Šä¸Šã’ã‚‹ã€‚"},
      "LRLR": {name:"ã‚¢ã‚¤ãƒ‡ã‚¢ãƒãƒ³ã‚¿ãƒ¼", summary:"åºƒãæƒ…å ±ã‚’é›†ã‚ã€é¢ç™½ã„ä»®èª¬ã‚’æ¬¡ã€…ã¨è©¦ã™ç™ºæƒ³å®¶ã€‚"},
      "LRRL": {name:"æˆ¦ç•¥çš„ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼", summary:"å‹ã¡ç­‹ã‚’å†·é™ã«åˆ†æã—ã€æˆé•·é ˜åŸŸã¸æœæ•¢ã«æŒ‘ã‚€ã€‚"},
      "LRRR": {name:"é«˜é€Ÿãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ‘ãƒ¼", summary:"ã¾ãšã¯ã‚„ã£ã¦ã¿ã‚‹ã€‚å¤±æ•—ã‹ã‚‰å­¦ã³ã€é«˜é€Ÿã§æ­£è§£ã«è¿‘ã¥ãã€‚"},
      "RLLL": {name:"ä¿¡é ¼ã®ãƒ•ã‚¡ã‚·ãƒªãƒ†ãƒ¼ã‚¿ãƒ¼", summary:"äººã®è©±ã‚’å¼•ãå‡ºã—ã€ä¸å¯§ã«åˆæ„ã‚’ä½œã£ã¦å‰é€²ã•ã›ã‚‹ã€‚"},
      "RLLR": {name:"æ„›ã•ã‚Œã‚µãƒãƒ¼ã‚¿ãƒ¼", summary:"ãã®å ´ã®ç©ºæ°—ã‚’èª­ã¿ã€é–¢ã‚ã‚‹å…¨å“¡ãŒå¿ƒåœ°ã‚ˆã„ç’°å¢ƒã‚’ä½œã‚‹ã€‚"},
      "RLRL": {name:"é ¼ã‚Œã‚‹ãƒªãƒ¼ãƒ€ãƒ¼", summary:"å‘¨ã‚Šã‚’å·»ãè¾¼ã¿ãªãŒã‚‰ã€ç›®æ¨™ã«å‘ã‹ã£ã¦ç€å®Ÿã«é€²ã‚€ã€‚"},
      "RLRR": {name:"ç¾å ´ã®ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼", summary:"ãƒˆãƒ©ãƒ–ãƒ«ã‚‚ç¬‘é¡”ã§è§£æ±ºã€‚ãƒãƒ¼ãƒ ã®ç†±é‡ã‚’ä¸Šã’ã‚‹ã‚¨ãƒ³ã‚¸ãƒ³ã€‚"},
      "RRLL": {name:"ãƒ“ã‚¸ãƒ§ãƒ³ã‚’èªã‚‹ç¿»è¨³è€…", summary:"å¤§ããªå¤¢ã‚’ã€èª°ã‚‚ãŒç†è§£ã§ãã‚‹è¨€è‘‰ã¨è¨ˆç”»ã«è½ã¨ã™ã€‚"},
      "RRLR": {name:"å·»ãè¾¼ã¿å‹ã®å†’é™ºå®¶", summary:"ã€Œé¢ç™½ãã†ï¼ã€ã§å‘¨ã‚Šã‚’å·»ãè¾¼ã¿ã€å¤‰åŒ–ã®æ¸¦ã‚’ä½œã‚‹ã€‚"},
      "RRRL": {name:"æˆé•·ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼", summary:"äººã¨è³‡æºã‚’é›†ã‚ã€æœ€çŸ­è·é›¢ã§æˆæœã‚’å©ãå‡ºã™å®ŸåŠ›æ´¾ã€‚"},
      "RRRR": {name:"å³èˆˆã®ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ã‚¹ã‚¿", summary:"ã©ã‚“ãªçŠ¶æ³ã§ã‚‚ç¬æ™‚ã«æœ€é©è§£ã‚’å‡ºã—ã€å‘¨ã‚Šã‚’é©šã‹ã›ã‚‹ã€‚"},
    };

    const STORAGE_KEY = "shukatsu_diag_apple_v1";
    const PAGE_SIZE = 5; // 40å• Ã· 5å• = 8ãƒšãƒ¼ã‚¸

    const state = {
  step: "intro", // intro | quiz | gate | result
  page: 0,
  answers: {},
  profile: { name: "", email: "" }, // è¿½åŠ 
};


    /***********************
     * Functions
     ***********************/
    function loadState(){
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if(raw) Object.assign(state, JSON.parse(raw));
      } catch(e){}
    }
    function saveState(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }
    function resetState(){
      state.step = "intro";
      state.page = 0;
      state.answers = {};
      localStorage.removeItem(STORAGE_KEY);
      render();
    }

    
    function computeResult(){
      // 7æŠ: 1..7ï¼ˆå·¦=ãã†æ€ã†(å¼·) ã€œ å³=ãã†æ€ã‚ãªã„(å¼·)ï¼‰
      // ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°æ–¹é‡:
      // - ç«¯ã®å›ç­”(1/7)ã¯ã€Œç¢ºä¿¡ãŒå¼·ã„ã€ã¨ã¿ãªã—ã€é‡ã¿ã‚’ä¸Šã’ã‚‹
      // - éç·šå½¢å¤‰æ›ã§ä¸­é–“(3/5)ã®å½±éŸ¿ã‚’åœ§ç¸®ã—ã€ç«¯ãŒç›¸å¯¾çš„ã«åŠ¹ãã‚„ã™ãã™ã‚‹
      // - reverse:trueï¼ˆå³å´ã‚’è‚¯å®šã™ã‚‹æ–‡ï¼‰ã¯ (8-ans) ã§åè»¢ã—ã€ã€Œå·¦å¯„ã‚Š=ãƒ—ãƒ©ã‚¹ã€ã«çµ±ä¸€
      // - è»¸å†…ã§å›ç­”ãŒå‰²ã‚Œã¦ã„ã‚‹ï¼ˆç›¸æ®ºï¼‰å ´åˆã¯ã€éå‰°ã«æ–­å®šã—ãªã„ã‚ˆã†å°‘ã—ã ã‘ä¸­ç«‹ã¸å¯„ã›ã‚‹
      const SCALE = 7;
      const MID = 4;          // ä¸­å¤®
      const MAX_DEV = 3;      // MIDã‹ã‚‰ã®æœ€å¤§åå·®ï¼ˆ1 or 7ï¼‰
      const GAMMA = 1.35;     // éç·šå½¢ï¼šå¤§ãã„ã»ã©ä¸­é–“ãŒå¼±ã¾ã‚Šã€ç«¯ãŒç›¸å¯¾çš„ã«å¼·ããªã‚‹
      const EXTREME_BONUS = 0.35; // ç«¯(1/7)ã®é‡ã¿ +35%
      const COHERENCE_SHRINK = 0.20; // ç›¸æ®ºãŒå¼·ã„è»¸ã¯æœ€å¤§20%ã ã‘ä¸­ç«‹ã¸


      const raw = {A:0, B:0, C:0, D:0};        // å·¦(+)/å³(-)
      const absRaw = {A:0, B:0, C:0, D:0};     // çµ¶å¯¾å€¤ï¼ˆç›¸æ®ºã®è¨ˆç®—ï¼‰
      const maxRaw = {A:0, B:0, C:0, D:0};     // æ­£è¦åŒ–ç”¨
      const coherenceByAxis = {A:0, B:0, C:0, D:0};
      const breakdown = {A:[], B:[], C:[], D:[]};
      const allAnswers = [];

      
      const weightOf = (ansRaw) => {
        const isExtreme = (ansRaw === 1 || ansRaw === 7);
        return isExtreme ? (1 + EXTREME_BONUS) : 1;
      };

      const shapeAns = (ansAdj) => {
        // ansAdj: 1..7ï¼ˆå·¦=1, å³=7ï¼‰ / è¿”ã‚Šå€¤: -1..+1ï¼ˆå·¦=+ï¼‰
        const centered = (MID - ansAdj);     // -3..+3ï¼ˆå·¦=+ï¼‰
        const t = centered / MAX_DEV;        // -1..+1
        const mag = Math.min(1, Math.abs(t));
        const shaped = Math.sign(t) * Math.pow(mag, GAMMA);
        return shaped; // -1..+1
      };

      for(const q of QUESTIONS){
        const ansRaw = state.answers[q.id];  // 1..7
        if(!ansRaw) continue;

        allAnswers.push(ansRaw);

        // reverse:trueï¼ˆå³å´ã‚’è‚¯å®šã™ã‚‹æ–‡ï¼‰ã¯åè»¢ï¼ˆ8-ansï¼‰
        const ansAdj = q.reverse ? (SCALE + 1 - ansRaw) : ansRaw;

        const shaped = shapeAns(ansAdj);
        const w = weightOf(ansRaw) * (q.importance ?? 1);

        const contrib = w * shaped;          // å·¦å¯„ã‚Š:+ / å³å¯„ã‚Š:-
        raw[q.axis] += contrib;
        absRaw[q.axis] += Math.abs(contrib);
        maxRaw[q.axis] += w;                 // shapedã®æœ€å¤§ãŒ1ãªã®ã§ w ã‚’ç©ã‚€

        breakdown[q.axis].push({ id:q.id, text:q.text, ans: ansRaw, contrib });
      }

const means = {};
      const hard = {};
      const norm = {};     // -1..1ï¼ˆ+ãŒå·¦å¯„ã‚Šï¼‰
      const pos = {};      // 0..100ï¼ˆå·¦=0, ä¸­å¤®=50, å³=100ï¼‰
      const leftPct = {};  // 0..100ï¼ˆå·¦ã®å¼·ã•ï¼‰
      const decisiveness = {}; // 0..1ï¼ˆä¸­ç«‹ã‹ã‚‰ã©ã‚Œã ã‘é›¢ã‚Œã¦ã„ã‚‹ã‹ï¼‰

      ["A","B","C","D"].forEach(k => {
        const denom = maxRaw[k] || 1;

        // coherence: 1=ä¸€è²«ã€0=å·¦å³ãŒæ‹®æŠ—ï¼ˆç›¸æ®ºï¼‰
        const coherence = absRaw[k] ? (Math.abs(raw[k]) / absRaw[k]) : 0;
        coherenceByAxis[k] = coherence;

        // ç›¸æ®ºãŒå¼·ã„ã»ã©å°‘ã—ä¸­ç«‹ã¸ï¼ˆä¸¡æ–¹ã®è‰¯ã•ã‚’æŒã¤ã‚±ãƒ¼ã‚¹ã‚’å°Šé‡ï¼‰
        const adjusted = raw[k] * (1 - COHERENCE_SHRINK * (1 - coherence));

        norm[k] = Math.max(-1, Math.min(1, adjusted / denom));
        means[k] = MID + norm[k] * MAX_DEV; // 1..4ã«æˆ»ã™
        hard[k] = norm[k] > 0 ? "L" : "R";

        pos[k] = Math.max(0, Math.min(100, 50 - norm[k] * 50));
        leftPct[k] = Math.round((norm[k] + 1) * 50);
        decisiveness[k] = Math.min(1, Math.abs(norm[k]));
      });

      // ç›´ç·šå›ç­”ï¼ˆåŒã˜é¸æŠè‚¢ã«åã‚‹ï¼‰æ¤œçŸ¥ï¼šç²¾åº¦ãŒè½ã¡ã‚„ã™ã„
      let straightLine = false;
      if(allAnswers.length){
        const freq = {1:0,2:0,3:0,4:0};
        allAnswers.forEach(a => freq[a]++);
        const maxF = Math.max(freq[1],freq[2],freq[3],freq[4]);
        straightLine = (maxF / allAnswers.length) >= 0.80;
      }

      const code = hard.A + hard.B + hard.C + hard.D;
      return { means, hard, code, norm, pos, leftPct, coherenceByAxis, breakdown, decisiveness, straightLine, char: CHARACTERS[code] };
    }

    // --- Rendering ---


    const app = document.getElementById("app");
    document.getElementById("btnReset").onclick = () => {
      if(confirm("æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—ã¾ã™ã‹ï¼Ÿ")) resetState();
    };

    function render(){
      window.scrollTo(0,0);
      if(state.step === "intro") renderIntro();
      else if(state.step === "quiz") renderQuiz();
      else renderResult();
    }

    function renderIntro(){
      const count = Object.keys(state.answers).length;
      app.innerHTML = `
        <div class="panel fade-in" style="text-align:center; padding: 60px 20px;">
          <p class="kicker">å°±æ´»è‡ªå·±åˆ†æ</p>
          <h2 class="big">ã‚ãªãŸã®ã€ŒæŒã¡å‘³ã€ã‚’<br>4ã¤ã®è»¸ã§è¨€èªåŒ–ã—ã¾ã™ã€‚</h2>
          <p class="text-body" style="max-width:400px; margin:0 auto 30px;">
            ç›´æ„Ÿã§é¸ã¶40å•ã®è³ªå•ã‹ã‚‰ã€ã‚ãªãŸã®å¼·ã¿ãŒæ´»ãã‚‹ç’°å¢ƒã‚„ã€ESãƒ»é¢æ¥ã§ã®ã‚¢ãƒ”ãƒ¼ãƒ«æ–¹æ³•ã‚’ææ¡ˆã—ã¾ã™ã€‚
          </p>
          <button class="primary" id="btnStart" style="padding:16px 32px; font-size:16px;">
            ${count > 0 ? "è¨ºæ–­ã‚’å†é–‹ã™ã‚‹" : "è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹"}
          </button>
          ${count > 0 ? `<p style="font-size:12px; color:#86868b; margin-top:16px;">${count} / 40å• å›ç­”æ¸ˆã¿</p>` : ""}
        </div>
        
        <div class="card-grid">
          <div class="info-card">
            <h3>æƒ…å ±åé›†ã®ã‚¹ã‚¿ã‚¤ãƒ«</h3>
            <div class="text-body" style="font-size:12px;">è‡ªåˆ†ã§èª­ã¿è¾¼ã‚€ vs äººã¨è©±ã™</div>
          </div>
          <div class="info-card">
            <h3>å¥½ã‚€ç’°å¢ƒ</h3>
            <div class="text-body" style="font-size:12px;">å®‰å®šãƒ»ä»•çµ„ã¿ vs å¤‰åŒ–ãƒ»ã‚«ã‚ªã‚¹</div>
          </div>
          <div class="info-card">
            <h3>ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³</h3>
            <div class="text-body" style="font-size:12px;">æ„ç¾©ãƒ»å…±æ„Ÿ vs åˆç†ãƒ»æˆæœ</div>
          </div>
          <div class="info-card">
            <h3>ä»•äº‹ã®é€²ã‚æ–¹</h3>
            <div class="text-body" style="font-size:12px;">è¨ˆç”»çš„ vs è‡¨æ©Ÿå¿œå¤‰</div>
          </div>
        </div>
      `;
      document.getElementById("btnStart").onclick = () => {
        state.step = "quiz";
        // æœªå›ç­”ã®æœ€åˆã®ãƒšãƒ¼ã‚¸ã¸
        const idx = QUESTIONS.findIndex(q => !state.answers[q.id]);
        state.page = idx >= 0 ? Math.floor(idx / PAGE_SIZE) : 0;
        render();
      };
    }

    function renderQuiz(){
      const start = state.page * PAGE_SIZE;
      const currentQs = QUESTIONS.slice(start, start + PAGE_SIZE);
      const totalPage = Math.ceil(QUESTIONS.length / PAGE_SIZE);
      const progress = Math.round((Object.keys(state.answers).length / QUESTIONS.length) * 100);

      const qHtml = currentQs.map((q, i) => {
        const val = state.answers[q.id];
        return `
          <div class="qCard fade-in" style="animation-delay: ${i*0.05}s">
            <div class="kicker" style="color:#86868b; margin-bottom:4px;">Q${start+i+1}</div>
            <p class="qText">${q.text}</p>
            <div class="likert7">
              <div class="likert-end left">ãã†æ€ã†</div>
              ${[1,2,3,4,5,6,7].map(n => {
                const side = n<=3 ? "left" : (n===4 ? "mid" : "right");
                const sel = (val === n) ? "selected" : "";
                return `<button type="button" class="likert-btn ${side} ${sel}" data-i="${n}" data-qid="${q.id}" data-val="${n}" aria-label="é¸æŠè‚¢ ${n}"></button>`;
              }).join("")}
              <div class="likert-end right">ãã†æ€ã‚ãªã„</div>
            </div>
          </div>
        `;
      }).join("");

      app.innerHTML = `
        <div class="panel">
          <div class="progress-wrap">
            <div class="progress-meta">
              <span>é€²è¡ŒçŠ¶æ³</span>
              <span>${progress}%</span>
            </div>
            <div class="progress-track">
              <div class="progress-fill" style="width:${progress}%"></div>
            </div>
          </div>

          <div style="margin-top:30px;">
            ${qHtml}
          </div>

          <div style="display:flex; justify-content:space-between; margin-top:30px;">
            <button id="btnPrev" ${state.page===0 ? "disabled":""}>æˆ»ã‚‹</button>
            <button class="primary" id="btnNext">
              ${state.page === totalPage - 1 ? "çµæœã‚’è¦‹ã‚‹" : "æ¬¡ã¸"}
            </button>
          </div>
        </div>
      `;

      // Event Listeners
      currentQs.forEach(q => {
        document.querySelectorAll(`button.likert-btn[data-qid="${q.id}"]`).forEach(btn => {
          btn.onclick = (e) => {
            const val = parseInt(btn.dataset.val);
            state.answers[q.id] = val;

            // é¸æŠçŠ¶æ…‹ã®è¦‹ãŸç›®æ›´æ–°
            document.querySelectorAll(`button.likert-btn[data-qid="${q.id}"]`).forEach(b => b.classList.remove("selected"));
            btn.classList.add("selected");

            saveState();

            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã ã‘æ›´æ–°
            const p = Math.round((Object.keys(state.answers).length / QUESTIONS.length) * 100);
            document.querySelector(".progress-fill").style.width = p + "%";
            document.querySelector(".progress-meta span:last-child").innerText = p + "%";
          };
        });
      });
document.getElementById("btnPrev").onclick = () => {
        state.page--;
        render();
      };

      document.getElementById("btnNext").onclick = () => {
        // Validation
        const missing = currentQs.find(q => !state.answers[q.id]);
        if(missing){
          alert("ã¾ã å›ç­”ã—ã¦ã„ãªã„é …ç›®ãŒã‚ã‚Šã¾ã™");
          return;
        }
        if(state.page < totalPage - 1){
          state.page++;
          render();
        } else {
          state.step = "result";
          render();
        }
      };
    }
    async function submitLead(payload){
  const r = await fetch("/api/lead", {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify(payload)
  });
  const data = await r.json().catch(()=> ({}));
  if(!r.ok) throw new Error(data?.error || "é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ");
  return data;
}

function renderGate(){
  // å›ç­”ãŒæƒã£ã¦ã‚‹å‰æã ãŒã€å¿µã®ãŸã‚
  const answered = Object.keys(state.answers).length;
  if(answered < QUESTIONS.length){
    state.step = "quiz";
    saveState();
    render();
    return;
  }

  const res = computeResult(); // çµæœã¯ã“ã“ã§è¨ˆç®—ï¼ˆè¡¨ç¤ºã¯ã¾ã ã—ãªã„ï¼‰

  app.innerHTML = `
    <div class="panel fade-in">
      <p class="kicker">çµæœã®é–²è¦§ã«ã¯ç™»éŒ²ãŒå¿…è¦ã§ã™</p>
      <h2 class="big">åå‰ã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
      <p class="text-body" style="margin-top:-6px;">
        å…¥åŠ›å¾Œã™ãã«è¨ºæ–­çµæœã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
      </p>

      <div style="margin-top:22px; display:grid; gap:12px; max-width:520px;">
        <div>
          <div style="font-size:12px; color:var(--text-sub); margin-bottom:6px;">ãŠåå‰</div>
          <input id="regName" type="text" placeholder="ä¾‹ï¼‰å±±ç”° å¤ªéƒ"
            style="width:100%; padding:14px 14px; border-radius:14px; border:1px solid var(--line); background:#fff; font-size:14px;">
        </div>
        <div>
          <div style="font-size:12px; color:var(--text-sub); margin-bottom:6px;">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</div>
          <input id="regEmail" type="email" placeholder="example@gmail.com"
            style="width:100%; padding:14px 14px; border-radius:14px; border:1px solid var(--line); background:#fff; font-size:14px;">
        </div>

        <label style="display:flex; gap:10px; align-items:flex-start; font-size:12px; color:var(--text-sub);">
          <input id="regConsent" type="checkbox" style="margin-top:3px;">
          <span>å…¥åŠ›ã—ãŸæƒ…å ±ã‚’é€£çµ¡ãƒ»æ”¹å–„ã®ãŸã‚ã«ä¿å­˜ã™ã‚‹ã“ã¨ã«åŒæ„ã—ã¾ã™ã€‚</span>
        </label>

        <div id="regErr" style="display:none; color:var(--danger); font-size:12px;"></div>

        <div style="display:flex; gap:10px; margin-top:8px;">
          <button id="btnGateBack" style="background:transparent; color:#86868b;">æˆ»ã‚‹</button>
          <button class="primary" id="btnGateGo" style="flex:1; padding:14px 18px;">çµæœã‚’è¦‹ã‚‹</button>
        </div>

        <div style="margin-top:10px; font-size:11px; color:var(--text-sub);">
          é€ä¿¡ã•ã‚Œã‚‹å†…å®¹ï¼šåå‰ã€ãƒ¡ãƒ¼ãƒ«ã€è¨ºæ–­TYPEï¼ˆ${res.code}ï¼‰ã€å„è»¸ã®æ¯”ç‡ï¼ˆAã€œDï¼‰
        </div>
      </div>
    </div>
  `;

  // æ—¢ã«å…¥åŠ›ãŒã‚ã‚Œã°åæ˜ 
  const nameEl = document.getElementById("regName");
  const emailEl = document.getElementById("regEmail");
  nameEl.value = state.profile?.name || "";
  emailEl.value = state.profile?.email || "";

  document.getElementById("btnGateBack").onclick = () => {
    state.step = "quiz";
    saveState();
    render();
  };

  document.getElementById("btnGateGo").onclick = async () => {
    const errEl = document.getElementById("regErr");
    errEl.style.display = "none";

    const name = (nameEl.value || "").trim();
    const email = (emailEl.value || "").trim();
    const consent = document.getElementById("regConsent").checked;

    const emailOk = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);

    if(!name){ errEl.textContent = "åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"; errEl.style.display="block"; return; }
    if(!emailOk){ errEl.textContent = "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„"; errEl.style.display="block"; return; }
    if(!consent){ errEl.textContent = "åŒæ„ã«ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„"; errEl.style.display="block"; return; }

    const btn = document.getElementById("btnGateGo");
    btn.disabled = true;
    btn.textContent = "é€ä¿¡ä¸­â€¦";

    try{
      // é€ä¿¡ãƒ‡ãƒ¼ã‚¿ï¼ˆå¿…è¦ã«å¿œã˜ã¦å¢—æ¸›ï¼‰
      const payload = {
        name,
        email,
        type: res.code,
        axes: res.leftPct,   // A,B,C,DãŒ0..100
        createdAt: new Date().toISOString(),
      };

      await submitLead(payload);

      // ç™»éŒ²æƒ…å ±ä¿å­˜ï¼ˆæ¬¡å›ã‚¹ã‚­ãƒƒãƒ—ç”¨ï¼‰
      state.profile = { name, email };
      state.step = "result";
      saveState();
      render();
    }catch(e){
      errEl.textContent = e?.message || "é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ";
      errEl.style.display="block";
      btn.disabled = false;
      btn.textContent = "çµæœã‚’è¦‹ã‚‹";
    }
  };
}


    function renderResult(){
      const res = computeResult();
      const char = res.char;
      
      // ESãƒ»é¢æ¥ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã®ç”Ÿæˆ
      const isL = (k) => res.hard[k] === "L";
      const esTip = isL("C") 
        ? "ã€Œãªãœã‚„ã‚‹ã‹ï¼ˆåŸä½“é¨“ãƒ»ä¾¡å€¤è¦³ï¼‰ã€ã‚’ä¸­å¿ƒã«æ·»ãˆã€å…±æ„Ÿã‚’ç”Ÿã‚€ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã§æ§‹æˆã™ã‚‹ã€‚"
        : "ã€Œã©ã†æˆæœã‚’å‡ºã™ã‹ï¼ˆèª²é¡Œãƒ»è§£æ±ºç­–ãƒ»çµæœï¼‰ã€ã‚’æ•°å€¤ã‚„æ¯”è¼ƒã‚’ç”¨ã„ã¦è«–ç†çš„ã«æ§‹æˆã™ã‚‹ã€‚";
        
      const interviewTip = isL("D")
        ? "çµè«–ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã«åŠ ãˆã€ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆå·¥å¤«ã—ãŸç‚¹ãƒ»åˆ¤æ–­åŸºæº–ï¼‰ã‚’ä¸å¯§ã«è©±ã™ã¨ä¿¡é ¼ã•ã‚Œã‚„ã™ã„ã€‚"
        : "è‡¨æ©Ÿå¿œå¤‰ãªå¯¾å¿œåŠ›ã‚’ã‚¢ãƒ”ãƒ¼ãƒ«ã€‚æƒ³å®šå¤–ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚’ã©ã†ä¹—ã‚Šè¶ŠãˆãŸã‹ã‚’æ¥½ã—ãã†ã«è©±ã™ã€‚";

      const oneStep = isL("A")
        ? "æ¡ç”¨ã‚µã‚¤ãƒˆ/IR/ç¤¾å“¡ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼ã‚’èª­ã¿ã€åˆºã•ã£ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’3ã¤ãƒ¡ãƒ¢ã™ã‚‹ã€‚"
        : "OBè¨ªå•ãƒ»èª¬æ˜ä¼šãƒ»SNSã®DMç­‰ã§ã€1äººã«â€œè³ªå•ã‚’1ã¤â€æŠ•ã’ã¦ä¼šè©±ã‚’ä½œã‚‹ã€‚";

      app.innerHTML = `
        <div class="panel fade-in">
          <div class="result-hero">
            <p class="kicker">è¨ºæ–­çµæœ</p>
            <h2 class="big" style="font-size:28px;">${char.name}</h2>
            <p class="text-body" style="color:var(--text-main); font-weight:500;">${char.summary}</p>
            ${res.straightLine ? `<p class="text-body" style="margin-top:10px; color:#6e6e73; font-size:13px;">
              â€»å›ç­”ãŒåŒã˜é¸æŠè‚¢ã«åã£ã¦ã„ã‚‹ãŸã‚ã€å‚¾å‘ãŒæ¸¬ã‚Šã«ãã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚è¿·ã£ãŸã‚‰ç›´æ„Ÿã§é¸ã³ç›´ã™ã¨ç²¾åº¦ãŒä¸ŠãŒã‚Šã¾ã™ã€‚
            </p>` : ``}

            
            <div class="char-image-placeholder">
               <span>ã“ã“ã«ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”»åƒãŒå…¥ã‚Šã¾ã™</span> 
            </div>
            
            <div style="display:inline-block; background:#f0f0f5; padding:6px 16px; border-radius:20px; font-size:12px; font-family:monospace; color:#86868b;">
              TYPE: ${res.code}
            </div>
          </div>

          <div style="margin-top:40px;">
            <p class="kicker" style="margin-bottom:16px;">4ã¤ã®è»¸ã®å‚¾å‘</p>
            ${["A","B","C","D"].map(k => {
              const ax = AXES[k];
              const left = res.leftPct[k];
              const right = 100 - left;
              const coh = Math.round((res.coherenceByAxis[k] || 0) * 100);
              const rows = (res.breakdown[k] || []).map(it => {
                const dir = it.contrib > 0.06 ? "â†" : (it.contrib < -0.06 ? "â†’" : "ãƒ»");
                return `<div class="row"><div class="q">${it.id}. ${it.text}</div><div class="dir">${dir}</div><div class="a">${ANS_LABEL[it.ans] || it.ans}</div></div>`;
              }).join("");
              return `
                <div class="axis-row">
                  <span class="axis-name">${ax.name}</span>
                  <div class="axis-labels">
                    <span>${ax.left}</span>
                    <span>${ax.right}</span>
                  </div>
                  <div class="axis-track">
                    <div class="axis-center"></div>
                    <div class="axis-dot" style="left:${res.pos[k]}%;"></div>
                  </div>
                  <div class="axis-meta">
                    <span>${ax.left} ${left}%</span>
                    <span>ä¸€è²«åº¦ ${coh}%</span>
                    <span>${ax.right} ${right}%</span>
                  </div>
                  <details class="axis-details">
                    <summary>å†…è¨³ã‚’è¦‹ã‚‹</summary>
                    <div class="axis-breakdown">${rows}</div>
                  </details>
                </div>
              `;
            }).join("")}
          </div>
        </div>

        <div class="card-grid fade-in" style="animation-delay:0.2s;">
          <div class="info-card">
            <h3>ğŸ“ ESã®æ›¸ãæ–¹</h3>
            <p class="text-body">${esTip}</p>
          </div>
          <div class="info-card">
            <h3>ğŸ—£ é¢æ¥ã®ãƒ’ãƒ³ãƒˆ</h3>
            <p class="text-body">${interviewTip}</p>
          </div>
          <div class="info-card">
            <h3>ğŸ’¡ ä»Šæ—¥ã®ä¸€æ­©</h3>
            <p class="text-body">${oneStep}</p>
          </div>
          <div class="info-card">
            <h3>ğŸ¢ åˆã†ç’°å¢ƒã®å‚¾å‘</h3>
            <p class="text-body">
              ${isL("B") ? "å½¹å‰²ã‚„è©•ä¾¡åˆ¶åº¦ãŒæ•´ã£ãŸã€å®‰å®šã—ã¦ã‚¹ã‚­ãƒ«ã‚’ç£¨ã‘ã‚‹ç’°å¢ƒã€‚" : "å¤‰åŒ–ãŒæ¿€ã—ãã€è‡ªåˆ†ã®è£é‡ã§ãƒ«ãƒ¼ãƒ«ã‚’ä½œã£ã¦ã„ã‘ã‚‹ç’°å¢ƒã€‚"}
            </p>
          </div>
        </div>
        
        <div style="text-align:center; margin-top:40px;">
           <button id="btnBack" style="color:#86868b; background:transparent;">å›ç­”ã‚’è¦‹ç›´ã™</button>
        </div>
      `;

      document.getElementById("btnBack").onclick = () => {
        state.step = "quiz";
        state.page = 0;
        render();
      };
    }

    // Start
    loadState();
    render();

  </script>
</body>
</html>